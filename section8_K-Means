delete from PAL_KMEANS_ASSIGNED_TBL;
delete from PAL_KMEANS_CENTERS_cars4variables_TBL;
 
DROP TABLE "ML_DATA"."carsfourvariables";
CREATE COLUMN TABLE "ML_DATA"."carsfourvariables" 
("id" INTEGER , 
"mpg" DOUBLE , 
"hp" DOUBLE,
"drat" DOUBLE,
"qsec" DOUBLE
);

INSERT INTO "ML_DATA"."carsfourvariables" ("id","mpg","hp","drat","qsec") 
select "id","mpg","hp","drat","qsec" from "ML_DATA"."cars4vars"; 


DROP TYPE PAL_KMEANS_CENTERS_cars4variables;
CREATE TYPE  PAL_KMEANS_CENTERS_cars4variables AS TABLE(
          "CLUSTER_ID" INTEGER,
 	  "mpg" DOUBLE, 
 	  "hp" DOUBLE,
	  "drat" DOUBLE,
	  "qsec" DOUBLE
);

DROP TABLE PAL_KMEANS_CENTERS_cars4variables_TBL;
CREATE COLUMN TABLE PAL_KMEANS_CENTERS_cars4variables_TBL LIKE  PAL_KMEANS_CENTERS_cars4variables;


DROP TABLE #PAL_PARAMETER_TBL;
CREATE LOCAL TEMPORARY COLUMN TABLE #PAL_PARAMETER_TBL("PARAM_NAME" NVARCHAR(256),"INT_VALUE" INTEGER, "DOUBLE_VALUE" DOUBLE, "STRING_VALUE" NVARCHAR(1000));
INSERT INTO #PAL_PARAMETER_TBL VALUES ('THREAD_RATIO', NULL, 0.2, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES('GROUP_NUMBER', 4, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('INIT_TYPE', 1, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('DISTANCE_LEVEL',2, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('MAX_ITERATION', 100, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('EXIT_THRESHOLD', NULL, 1.0E-6, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('CATEGORY_WEIGHTS', NULL, 0.5, NULL);

CALL _SYS_AFL.PAL_KMEANS("ML_DATA"."carsfourvariables", #PAL_PARAMETER_TBL, "ML_DATA".PAL_KMEANS_ASSIGNED_TBL,"ML_DATA".PAL_KMEANS_CENTERS_cars4variables_TBL, ?, ?, ?) WITH OVERVIEW;

SELECT  * FROM "ML_DATA"."PAL_KMEANS_ASSIGNED_TBL" where cluster = 1; 

select avg(SLIGHT_SILHOUETTE) from "ML_DATA".PAL_KMEANS_ASSIGNED_TBL;
