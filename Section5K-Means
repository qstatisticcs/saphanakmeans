DROP TABLE PAL_KMEANS_DATA_TBL_TWOD;
CREATE COLUMN TABLE PAL_KMEANS_DATA_TBL_TWOD(
	"ID" INTEGER,
	"V000" DOUBLE,
	"V002" DOUBLE
);

INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (0, 1.5,  0.5);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (1, 1.6,  0.5);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (2, 1.7,  0.7);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (3, 1.8,  0.6);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (4, 1.7,  0.8);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (5, 1.5,  0.55);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (6, 1.4,  0.55);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (7, 1.3,  0.65);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (8, 1.5,  0.65);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (9, 1.8,  0.7);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (10, 1.5, 0.3);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (11, 1.6, 0.5);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (12, 1.6, 0.6);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (13, 1.5, 0.5);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (14, 1.5, 0.65);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (15, 1.5, 0.55);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (16, 1.6, 0.5);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (17, 1.6, 0.4);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (18, 1.5, 0.5);
INSERT INTO PAL_KMEANS_DATA_TBL_TWOD VALUES (19, 1.5, 0.6);

DROP TYPE PAL_KMEANS_ASSIGNED_T;
CREATE TYPE PAL_KMEANS_ASSIGNED_T AS TABLE(
"ID" INTEGER,
"CLUSTER" INTEGER,
"DISTANCE" DOUBLE,
"SLIGHT_SILHOUETTE" DOUBLE
);
DROP TABLE PAL_KMEANS_ASSIGNED_TBL;
CREATE COLUMN TABLE PAL_KMEANS_ASSIGNED_TBL LIKE PAL_KMEANS_ASSIGNED_T;

DROP TYPE PAL_KMEANS_CENTERS_T1;
CREATE TYPE  PAL_KMEANS_CENTERS_T1 AS TABLE(
          "CLUSTER_ID" INTEGER,           
	  "V000" DOUBLE,
	  "V002" DOUBLE
);

DROP TABLE PAL_KMEANS_CENTERS_TBL2d;
CREATE COLUMN TABLE PAL_KMEANS_CENTERS_TBL2d LIKE PAL_KMEANS_CENTERS_T1;

DROP TABLE #PAL_PARAMETER_TBL;
CREATE LOCAL TEMPORARY COLUMN TABLE #PAL_PARAMETER_TBL(
	"PARAM_NAME" NVARCHAR(256), 
	"INT_VALUE" INTEGER, 
	"DOUBLE_VALUE" DOUBLE, 
	"STRING_VALUE" NVARCHAR(1000)
);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('THREAD_RATIO', NULL, 0.2, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('GROUP_NUMBER', 2, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('INIT_TYPE', 1, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('DISTANCE_LEVEL',2, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('MAX_ITERATION', 100, NULL, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('EXIT_THRESHOLD', NULL, 1.0E-6, NULL);
INSERT INTO #PAL_PARAMETER_TBL VALUES ('CATEGORY_WEIGHTS', NULL, 0.5, NULL);

delete from PAL_KMEANS_ASSIGNED_TBL;

CALL _SYS_AFL.PAL_KMEANS(PAL_KMEANS_DATA_TBL_TWOD, "#PAL_PARAMETER_TBL", PAL_KMEANS_ASSIGNED_TBL, PAL_KMEANS_CENTERS_TBL2d, ?, ?, ?) WITH OVERVIEW;

select avg(SLIGHT_SILHOUETTE) from PAL_KMEANS_ASSIGNED_TBL;

select t.ID as SourceID,k.ID as Results_ID,t.V000,t.V002, k.CLUSTER,k.DISTANCE,k.SLIGHT_SILHOUETTE from PAL_KMEANS_DATA_TBL_TWOD t, PAL_KMEANS_ASSIGNED_TBL k
where t.ID = k.ID
and k.CLUSTER = 1;

select * from PAL_KMEANS_CENTERS_TBL2d;
